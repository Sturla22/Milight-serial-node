<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Milight</title>

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">
	<meta charset="utf-8">

	<!-- JQueryUI style -->
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css" media="screen">
    	body{
    		background-color: hsl(0,50%,50%);
    	}
    </style>
  </head>
  <body>
  	<div class="container-fluid">
  		<div class="row">
  			<div class="col-sm-3"></div>
  			<div class="col-sm-6">
	  			<h1 class="text-center">Milight control</h1>
	  			<div class="text-center">
	  				<button type="button" id="on" class="btn btn-success btn-lg">ON</button>
					<button type="button" id="off" class="btn btn-danger btn-lg">OFF</button>
					<button type="button" id="white" class="btn btn-default btn-lg">White</button>
	  			</div>
	  			<br>
	  			<label for="brightness">Brightness</label>
	  			<input type="text" readonly name="" id="brightness" class="form-control" value="0" required="required" pattern="" title="">
	  			<br>
		  		<div id="brightness-slider"></div>
		  		<br>
		  		<label for="color">Color</label>
	  			<input type="text" readonly name="" id="color" class="form-control" value="0" required="required" pattern="" title="">
	  			<br>
		  		<div id="color-slider"></div>
		  		<br>
		  		<div class="text-center">
		  			<button type="button" id="all" class="btn btn-success btn-lg groupBtn">ALL</button>
	  				<button type="button" id="ch1" class="btn btn-default btn-lg groupBtn">CH 1</button>
					<button type="button" id="ch2" class="btn btn-default btn-lg groupBtn">CH 2</button>
					<button type="button" id="ch3" class="btn btn-default btn-lg groupBtn">CH 3</button>
					<button type="button" id="ch4" class="btn btn-default btn-lg groupBtn">CH 4</button>
	  			</div>
			</div>
			<div class="col-sm-3"></div>
  		</div>
  	</div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
	<!-- JQueryUI -->
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>
	<!-- Socket.io -->
	<script src="https://cdn.socket.io/socket.io-1.0.0.js"></script>
	<script type="text/javascript" charset="utf-8" async defer>
  	  var White = 1,
  	  	  currentGroup = 0,
  	  	  color = 0,
  	  	  colorBrightness = 25,
  	  	  whiteBrightness = 25;
	  var socket = io.connect();
	  function refreshColor(){
	  	var h = parseInt($( "#color-slider" ).slider( "value" )*(360/255)),
	  		s = 50,
	  		l = parseInt($( "#brightness-slider" ).slider( "value" )*(50/25)+10);
	  	$( "body").css("background-color",function(){
	    	return "hsl("+h+","+s+"%,"+l+"%)";
	    });
	    socket.emit('Color',{
	    	color:$( "#color-slider" ).slider( "value" ),
	    	brightness:$( "#brightness-slider" ).slider( "value" )
	    });
	  }
	  function refreshWhite(){
	  	var l = parseInt($( "#brightness-slider" ).slider( "value" )*(50/25)+10);
	  	$( "body").css("background-color",function(){
	    	return "hsl(0,0%,"+l+"%)";
	    });
	    socket.emit('White',{
	    	brightness:$( "#brightness-slider" ).slider( "value" )
	    });
	  }
	  $(function() {
	  	socket.emit('ready');
	  	socket.on('Welcome',function(data){
		  White = data.white;
		  currentGroup = data.group;
		  color = data.color;
		  colorBrightness = data.colorBrightness;
		  whiteBrightness = data.whiteBrightness;
		  if(White){
			$( "#brightness" ).val(whiteBrightness);
			$( "#brightness-slider" ).slider('value',whiteBrightness);
		  }else{
			$( "#brightness" ).val(colorBrightness);
			$( "#brightness-slider" ).slider('value',colorBrightness);
		  }
		});
	    $( "#brightness-slider" ).slider({
	    	min:0,
	    	max:25,
	    	change: function(event, ui){
	    		$( "#brightness" ).val(ui.value);
	    		if(White){
	    			refreshWhite();
	    		}else{
	    			refreshColor();
	    		}
	    	},
	    	// maybe fun to uncomment if serialport ever works
	    	// slide: function(event, ui){
	    	// 	$( "#brightness" ).val(ui.value);
	    	// 	if(White){
	    	// 		refreshWhite();
	    	// 	}else{
	    	// 		refreshColor();
	    	// 	}
	    	// }
	    });
	    $( "#color-slider" ).slider({
	    	min:0,
	    	max:255,
	    	change: function(event, ui){
	    		$( "#color" ).val(ui.value);
	    		White = 0;
	    		refreshColor();
	    	},
	    	// maybe fun to uncomment if serialport ever works
	    	// slide: function(event, ui){
	    	// 	$( "#color" ).val(ui.value);
	    	// 	White = 0;
	    	// 	refreshColor();
	    	// },
	    });
	    // socket.on('White',function(data){
	    // 	$( "#brightness-slider" ).slider('value',data.brightness);
	    // });
	    // socket.on('Color',function(data){
	    // 	$( "#color-slider" ).slider('value',data.color);
	    // 	$( "#brightness-slider" ).slider('value',data.brightness);
	    // });
		
  	    $( "#color" ).val(color);
  	    $( "#color-slider" ).slider('value',color);
	    if(White){
		  refreshWhite();
	    }else{
	  	  refreshColor();
	    }
	    $( "#white" ).click(function(){
		  White = 1;
		  refreshWhite();
		});
		$( "#on" ).click(function(){
		  if(White){
		    refreshWhite();
		  }else{
			refreshColor();
		  }
		  socket.emit('On');
		});
		$( "#off" ).click(function(){
		  $( "body").css("background-color",function(){
		    return "hsl(0,0%,0%)";
		  });
		  socket.emit('Off');
		});
		$( "#all" ).click(function(){
			currentGroup = 0;
		  $( ".groupBtn" ).removeClass('btn-success').addClass('btn-default')
		  $( "#all").removeClass('btn-default').addClass('btn-success')
		  socket.emit('group',{group:currentGroup});
		});
		$( "#ch1" ).click(function(){
		  currentGroup = 1;
		  $( ".groupBtn" ).removeClass('btn-success').addClass('btn-default')
		  $( "#ch1").removeClass('btn-default').addClass('btn-success')
		  socket.emit('group',{group:currentGroup});
		});
		$( "#ch2" ).click(function(){
		  currentGroup = 2;
		  $( ".groupBtn" ).removeClass('btn-success').addClass('btn-default')
		  $( "#ch2").removeClass('btn-default').addClass('btn-success')
		  socket.emit('group',{group:currentGroup});
		});
		$( "#ch3" ).click(function(){
		  currentGroup = 3;
		  $( ".groupBtn" ).removeClass('btn-success').addClass('btn-default')
		  $( "#ch3").removeClass('btn-default').addClass('btn-success')
		  socket.emit('group',{group:currentGroup});
		});
		$( "#ch4" ).click(function(){
		  currentGroup = 4;
		  $( ".groupBtn" ).removeClass('btn-success').addClass('btn-default')
		  $( "#ch4").removeClass('btn-default').addClass('btn-success')
		  socket.emit('group',{group:currentGroup});
		});
	  });
  	</script>
  </body>
</html>